<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WiFi ë³´ì•ˆ ìŠ¤ìº”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #667eea;
            margin-bottom: 12px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 32px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        #loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            display: none;
        }
        
        #results {
            margin-top: 30px;
        }
        
        .results-header {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .network-item {
            padding: 15px;
            margin: 12px 0;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        
        .network-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .network-item:active {
            transform: scale(0.98);
        }
        
        .network-ssid {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .network-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .security-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .security-safe {
            background: #d4edda;
            color: #155724;
        }
        
        .security-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .security-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .security-critical {
            background: #f5c6cb;
            color: #721c24;
        }

        .current-wifi-section {
            margin: 24px 0;
        }

        .current-wifi-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .current-wifi {
            padding: 16px;
            background: #eef2ff;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .current-wifi-details {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            font-size: 14px;
            color: #555;
        }

        .current-wifi-empty {
            font-size: 14px;
            color: #666;
        }

        .current-wifi-warning {
            margin-top: 10px;
            font-size: 13px;
            color: #b45309;
            line-height: 1.6;
        }

        .hidden {
            display: none !important;
        }

        .signal-strength {
            font-size: 12px;
            color: #888;
        }

        .rogue-alert {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 20px;
            background: #fdecea;
            color: #b71c1c;
            font-size: 12px;
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        /* íŒì—… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        
        .popup-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .popup-modal {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.3s;
        }
        
        .popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f0f0f0;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #666;
            transition: background 0.2s;
        }
        
        .popup-close:hover {
            background: #e0e0e0;
        }
        
        .popup-close:active {
            transform: scale(0.95);
        }
        
        .popup-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-right: 40px;
        }
        
        .popup-info-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .popup-info-item:last-child {
            border-bottom: none;
        }
        
        .popup-info-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .popup-info-value {
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }
        
        .popup-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .popup-safe {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #155724;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.6;
        }

        .popup-rogue {
            background: #fdecea;
            border-left: 4px solid #f44336;
            color: #b71c1c;
        }

        .popup-rogue .popup-warning-title,
        .popup-rogue .popup-warning-text {
            color: #b71c1c;
        }
        
        .popup-warning-title {
            font-size: 14px;
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .popup-warning-text {
            font-size: 13px;
            color: #856404;
            line-height: 1.6;
        }
        
        /* ìƒì„¸ ì§€ì¹¨ ìŠ¤íƒ€ì¼ */
        .popup-guidance {
            margin-top: 20px;
        }
        
        .popup-rogue-guidance {
            margin-bottom: 20px;
        }
        
        .guidance-box {
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            margin-bottom: 12px;
        }
        
        .popup-rogue-guidance .guidance-box {
            background: #fdecea;
            border-left: 4px solid #f44336;
        }
        
        .guidance-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }
        
        .popup-rogue-guidance .guidance-title {
            color: #b71c1c;
        }
        
        .guidance-description-box {
            padding: 16px;
            background: #ffffff;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #e0e0e0;
        }
        
        .popup-rogue-guidance .guidance-description-box {
            background: #fff5f5;
            border-color: #ffcdd2;
        }
        
        .guidance-description {
            font-size: 14px;
            color: #555;
            line-height: 1.8;
        }
        
        .popup-rogue-guidance .guidance-description {
            color: #721c24;
        }
        
        .guidance-section {
            padding: 16px;
            background: #ffffff;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #e0e0e0;
        }
        
        .popup-rogue-guidance .guidance-section {
            background: #fff5f5;
            border-color: #ffcdd2;
        }
        
        .guidance-tips {
            background: #eef2ff;
            border: 1px solid #c7d2fe;
        }
        
        .guidance-section-title {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .popup-rogue-guidance .guidance-section-title {
            color: #b71c1c;
        }
        
        .guidance-tips .guidance-section-title {
            color: #667eea;
        }
        
        .guidance-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .guidance-list li {
            font-size: 14px;
            color: #555;
            line-height: 1.8;
            margin-bottom: 8px;
            padding-left: 8px;
        }
        
        .popup-rogue-guidance .guidance-list li {
            color: #721c24;
        }
        
        .guidance-tips .guidance-list li {
            color: #555;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">WiSAFE</div>
        <h1>ğŸ“¶ WiFi ë³´ì•ˆ ìŠ¤ìº”</h1>
        <p class="subtitle">ì£¼ë³€ WiFi ë„¤íŠ¸ì›Œí¬ì˜ ë³´ì•ˆ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”</p>

        <div id="currentWifiSection" class="current-wifi-section hidden">
            <div class="current-wifi-title">í˜„ì¬ ì—°ê²°ëœ ì™€ì´íŒŒì´</div>
            <div id="currentWifi" class="current-wifi"></div>
        </div>
        
        <button id="scanButton" onclick="startScan()">ì™€ì´íŒŒì´ ìŠ¤ìº” ì‹œì‘</button>
        
        <div id="loading">ìŠ¤ìº” ì¤‘...</div>
        
        <div id="results"></div>
    </div>

    <!-- íŒì—… ëª¨ë‹¬ -->
    <div id="popupOverlay" class="popup-overlay" onclick="closePopup(event)">
        <div class="popup-modal" onclick="event.stopPropagation()">
            <button class="popup-close" onclick="closePopup()">Ã—</button>
            <div id="popupContent"></div>
        </div>
    </div>

    <script>
        const scanButton = document.getElementById('scanButton');
        const loading = document.getElementById('loading');
        const resultsDiv = document.getElementById('results');
        const popupOverlay = document.getElementById('popupOverlay');
        const popupContent = document.getElementById('popupContent');
        const currentWifiSection = document.getElementById('currentWifiSection');
        const currentWifiDiv = document.getElementById('currentWifi');
        let networksData = [];
        let ssidGroups = {};

        function loadCurrentWifiInfo() {
            if (!currentWifiDiv || !currentWifiSection) {
                return;
            }

            if (typeof Android === 'undefined' || !Android.getCurrentWiFiInfo) {
                currentWifiSection.classList.add('hidden');
                return;
            }

            try {
                const infoString = Android.getCurrentWiFiInfo();
                if (!infoString) {
                    currentWifiDiv.innerHTML = `
                        <div class="current-wifi-empty">í˜„ì¬ ì—°ê²°ëœ ì™€ì´íŒŒì´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    `;
                    currentWifiSection.classList.remove('hidden');
                    return;
                }

                const network = JSON.parse(infoString);
                const ssid = network.ssid || 'ì•Œ ìˆ˜ ì—†ìŒ';
                const securityLevel = network.security_level || 'warning';
                const protocol = network.protocol || 'N/A';
                const signal = network.signalStrength || 0;

                let signalText = '';
                if (signal > -50) signalText = 'ê°•í•¨';
                else if (signal > -70) signalText = 'ë³´í†µ';
                else signalText = 'ì•½í•¨';

                const ssidKey = getSsidKey(ssid);
                const group = ssidKey ? ssidGroups[ssidKey] : null;
                const isRogueSuspect = group
                    ? group.some(item => {
                        const itemProtocol = (item.protocol || '').toUpperCase();
                        return itemProtocol && itemProtocol !== 'OPEN';
                    }) && (network.protocol || '').toUpperCase() === 'OPEN'
                    : false;
                const cautionMessage = securityLevel === 'safe'
                    ? ''
                    : getWarningMessage(securityLevel, protocol);

                currentWifiDiv.innerHTML = `
                    <div class="current-wifi-details">
                        <span class="network-ssid">${escapeHtml(ssid)}</span>
                        <span class="security-badge security-${securityLevel}">
                            ${getSecurityText(securityLevel)}
                        </span>
                        <span class="signal-strength">ì‹ í˜¸: ${signalText} (${signal} dBm)</span>
                        <span>${escapeHtml(protocol)}</span>
                        ${isRogueSuspect ? '<span class="rogue-alert">ê°€ì§œ ì™€ì´íŒŒì´ ì˜ì‹¬ë©ë‹ˆë‹¤</span>' : ''}
                    </div>
                    ${cautionMessage ? `<div class="current-wifi-warning">${escapeHtml(cautionMessage)}</div>` : ''}
                `;
                currentWifiSection.classList.remove('hidden');
            } catch (error) {
                console.error('í˜„ì¬ WiFi ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.', error);
                currentWifiSection.classList.add('hidden');
            }
        }
        
        function startScan() {
            if (typeof Android === 'undefined' || !Android.startWiFiScan) {
                alert('Android ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì•±ì´ ì œëŒ€ë¡œ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // UI ì—…ë°ì´íŠ¸
            scanButton.disabled = true;
            scanButton.textContent = 'ìŠ¤ìº” ì¤‘...';
            loading.style.display = 'block';
            resultsDiv.innerHTML = '';
            
            // Android ë„¤ì´í‹°ë¸Œ ìŠ¤ìº” ì‹œì‘
            Android.startWiFiScan();
        }

        // Androidì—ì„œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ - ìŠ¤ìº” ì™„ë£Œ
        function handleAndroidWiFiScan(networks) {
            scanButton.disabled = false;
            scanButton.textContent = 'ì™€ì´íŒŒì´ ìŠ¤ìº” ì‹œì‘';
            loading.style.display = 'none';
            ssidGroups = {};

            if (Array.isArray(networks)) {
                networks.forEach(network => {
                    const key = getSsidKey(network.ssid);
                    if (!key) {
                        return;
                    }
                    if (!ssidGroups[key]) {
                        ssidGroups[key] = [];
                    }
                    ssidGroups[key].push(network);
                });
            }

            if (!networks || networks.length === 0) {
                networksData = [];
                resultsDiv.innerHTML = '<div class="empty-state">ê²€ìƒ‰ëœ WiFi ë„¤íŠ¸ì›Œí¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                loadCurrentWifiInfo();
                return;
            }

            networks.forEach(network => {
                const group = ssidGroups[getSsidKey(network.ssid)];
                const protocol = (network.protocol || '').toUpperCase();
                const hasSecureVariant = group
                    ? group.some(item => {
                        const itemProtocol = (item.protocol || '').toUpperCase();
                        return itemProtocol && itemProtocol !== 'OPEN';
                    })
                    : false;
                network.isRogue = protocol === 'OPEN' && hasSecureVariant;
            });
            
            // ê²°ê³¼ í‘œì‹œ
            let html = '<div class="results-header">ê²€ìƒ‰ëœ ë„¤íŠ¸ì›Œí¬: ' + networks.length + 'ê°œ</div>';
            
            // ì‹ í˜¸ ê°•ë„ ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedNetworks = [...networks].sort((a, b) => (b.signalStrength || 0) - (a.signalStrength || 0));
            
            // ì •ë ¬ëœ ë„¤íŠ¸ì›Œí¬ ë°ì´í„° ì €ì¥
            networksData = sortedNetworks;
            loadCurrentWifiInfo();
            
            sortedNetworks.forEach((network, index) => {
                const ssid = network.ssid || 'ì•Œ ìˆ˜ ì—†ìŒ';
                const securityLevel = network.security_level || 'warning';
                const signal = network.signalStrength || 0;
                const rogueBadge = network.isRogue
                    ? '<span class="rogue-alert">ê°€ì§œ ì™€ì´íŒŒì´ ì˜ì‹¬ë©ë‹ˆë‹¤</span>'
                    : '';
                
                // ì‹ í˜¸ ê°•ë„ í‘œì‹œ
                let signalText = '';
                if (signal > -50) signalText = 'ê°•í•¨';
                else if (signal > -70) signalText = 'ë³´í†µ';
                else signalText = 'ì•½í•¨';
                
                html += `
                    <div class="network-item" onclick="showPopup(${index})">
                        <div class="network-ssid">${escapeHtml(ssid)}</div>
                        <div class="network-info">
                            <span class="security-badge security-${securityLevel}">
                                ${getSecurityText(securityLevel)}
                            </span>
                            <span class="signal-strength">ì‹ í˜¸: ${signalText} (${signal} dBm)</span>
                            ${rogueBadge}
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        // Androidì—ì„œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ - ì—ëŸ¬ ì²˜ë¦¬
        function handleAndroidWiFiScanError(error) {
            scanButton.disabled = false;
            scanButton.textContent = 'ì™€ì´íŒŒì´ ìŠ¤ìº” ì‹œì‘';
            loading.style.display = 'none';
            
            resultsDiv.innerHTML = `
                <div class="empty-state" style="color: #dc3545;">
                    <strong>ì˜¤ë¥˜ ë°œìƒ</strong><br>
                    ${escapeHtml(error)}
                </div>
            `;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getSsidKey(ssid) {
            return (ssid || '').trim();
        }
        
        function getSecurityText(level) {
            const texts = {
                'safe': 'ì•ˆì „',
                'warning': 'ì£¼ì˜',
                'danger': 'ìœ„í—˜',
                'critical': 'ë§¤ìš° ìœ„í—˜'
            };
            return texts[level] || level;
        }
        
        function getWarningMessage(level, protocol) {
            const messages = {
                'safe': 'ì•ˆì „í•œ ì™€ì´íŒŒì´ì…ë‹ˆë‹¤.',
                'warning': 'ì£¼ì˜ê°€ í•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ì…ë‹ˆë‹¤. ê°€ëŠ¥í•˜ë©´ WPA2 ì´ìƒì„ ì‚¬ìš©í•˜ì„¸ìš”.',
                'danger': 'ìœ„í—˜í•œ ë„¤íŠ¸ì›Œí¬ì…ë‹ˆë‹¤. ë˜ë„ë¡ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ê°„ë‹¨í•œ ì •ë³´ ê²€ìƒ‰ì—ë§Œ ì‚¬ìš©í•˜ê³ , ì€í–‰ ê°™ì€ ì¤‘ìš”í•œ ì—…ë¬´ë¥¼ ë³¼ ë•ŒëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.',
                'critical': 'ë§¤ìš° ìœ„í—˜í•œ ë„¤íŠ¸ì›Œí¬ì…ë‹ˆë‹¤. ë˜ë„ë¡ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. ê°„ë‹¨í•œ ì •ë³´ ê²€ìƒ‰ì—ë§Œ ì‚¬ìš©í•˜ê³ , ì€í–‰ ê°™ì€ ì¤‘ìš”í•œ ì—…ë¬´ë¥¼ ë³¼ ë•ŒëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.'
            };
            return messages[level] || messages['warning'];
        }
        
        function getProtocolGuidance(protocol) {
            const protocolUpper = (protocol || '').toUpperCase();
            
            // WPA3 ì²´í¬ (ê°€ì¥ ë¨¼ì € ì²´í¬)
            if (protocolUpper.includes('WPA3')) {
                return {
                    title: 'ğŸ”µ WPA3',
                    description: 'í˜„ì¬ ê°€ì¥ ìµœì‹ ì˜ ì™€ì´íŒŒì´ ë³´ì•ˆ ë°©ì‹ì´ì—ìš”.\n\në¹„ë°€ë²ˆí˜¸ë¥¼ í›”ì¹˜ê¸° ë§¤ìš° ì–´ë µê³ , ë³´ì•ˆì„±ì´ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤.',
                    recommendations: [
                        'âœ… ì•ˆì‹¬í•˜ê³  ì‚¬ìš©í•´ë„ ì¢‹ìŠµë‹ˆë‹¤.'
                    ],
                    tips: []
                };
            }
            // WPA2 ì²´í¬ (WPA2-PERSONAL, WPA2-ENTERPRISE í¬í•¨)
            else if (protocolUpper.includes('WPA2')) {
                return {
                    title: 'ğŸŸ¢ WPA2',
                    description: 'ì§€ê¸ˆ ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ” ë³´ì•ˆ ë°©ì‹ì´ì—ìš”.\n\nëŒ€ë¶€ë¶„ ì•ˆì „í•˜ì§€ë§Œ, ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ë‹¨ìˆœí•˜ë©´ ìœ„í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    recommendations: [
                        'ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê¸¸ê³  ë³µì¡í•˜ê²Œ ì„¤ì •í•˜ì„¸ìš”.',
                        'ğŸ”’ ê³µìœ ê¸° ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ëŠ” ì™€ì´íŒŒì´ ë¹„ë²ˆê³¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•˜ì„¸ìš”.',
                        'ğŸ§© ì˜¤ë˜ëœ ê¸°ê¸°ëŠ” WPA2 ì—°ê²° ì‹œ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                    ],
                    tips: []
                };
            }
            // WPA ì²´í¬ (WPA2ê°€ ì•„ë‹Œ WPAë§Œ)
            else if (protocolUpper === 'WPA') {
                return {
                    title: 'ğŸŸ  WPA',
                    description: 'WEPë³´ë‹¤ëŠ” ë‚«ì§€ë§Œ ì—¬ì „íˆ ë³´ì•ˆì´ ì•½í•œ í¸ì´ì—ìš”.\n\në¹„ë°€ë²ˆí˜¸ê°€ ìˆì–´ë„ ì‰½ê²Œ ëš«ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    recommendations: [
                        'âš ï¸ ê°€ëŠ¥í•˜ë©´ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.',
                        'ğŸ”’ ê¼­ ì¨ì•¼ í•œë‹¤ë©´ VPNì„ ì¼œë‘ì„¸ìš”.',
                        'ğŸš« ë¯¼ê°í•œ ì •ë³´ ì…ë ¥ì€ í”¼í•˜ì„¸ìš”.'
                    ],
                    tips: []
                };
            }
            else if (protocolUpper === 'WEP') {
                return {
                    title: 'ğŸ”´ WEP',
                    description: 'ì•„ì£¼ ì˜¤ë˜ëœ ë³´ì•ˆ ë°©ì‹ìœ¼ë¡œ, ì‚¬ì‹¤ìƒ ìë¬¼ì‡ ê°€ ì—†ëŠ” ì™€ì´íŒŒì´ì…ë‹ˆë‹¤.\n\nëˆ„êµ¬ë‚˜ ì‰½ê²Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    recommendations: [
                        'ğŸš« ê°€ëŠ¥í•˜ë©´ ì ˆëŒ€ ì—°ê²°í•˜ì§€ ë§ˆì„¸ìš”.',
                        'âŒ ì€í–‰, ê²°ì œ, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë“± ë¯¼ê°í•œ ì‘ì—…ì€ ì ˆëŒ€ í•˜ì§€ ë§ˆì„¸ìš”.',
                        'ğŸ”’ ê¼­ ì¨ì•¼ í•œë‹¤ë©´ VPNì„ ì¼œê³  ì‚¬ìš©í•˜ì„¸ìš”.',
                        'ğŸ“± ê°€ëŠ¥í•˜ë©´ ëª¨ë°”ì¼ ë°ì´í„°ë¥¼ ì´ìš©í•˜ëŠ” ê²Œ ë” ì•ˆì „í•©ë‹ˆë‹¤.'
                    ],
                    tips: []
                };
            }
            else if (protocolUpper === 'OPEN') {
                return {
                    title: 'âš ï¸ Open (ê³µê°œ ë„¤íŠ¸ì›Œí¬)',
                    description: 'ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ëŠ” ì™€ì´íŒŒì´ì˜ˆìš”.\n\nëˆ„êµ¬ë‚˜ ì ‘ì†í•  ìˆ˜ ìˆì–´ì„œ í†µì‹  ë‚´ìš©ì´ ì‰½ê²Œ ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    recommendations: [
                        'ğŸš« ê°€ëŠ¥í•˜ë©´ ì ˆëŒ€ ì—°ê²°í•˜ì§€ ë§ˆì„¸ìš”.',
                        'âŒ ì€í–‰, ê²°ì œ, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë“± ë¯¼ê°í•œ ì‘ì—…ì€ ì ˆëŒ€ í•˜ì§€ ë§ˆì„¸ìš”.',
                        'ğŸ”’ ê¼­ ì¨ì•¼ í•œë‹¤ë©´ VPNì„ ì¼œê³  ì‚¬ìš©í•˜ì„¸ìš”.',
                        'ğŸ“± ê°€ëŠ¥í•˜ë©´ ëª¨ë°”ì¼ ë°ì´í„°ë¥¼ ì´ìš©í•˜ëŠ” ê²Œ ë” ì•ˆì „í•©ë‹ˆë‹¤.'
                    ],
                    tips: []
                };
            } else {
                return null;
            }
        }
        
        function getRogueAPGuidance() {
            return {
                title: 'ğŸ›‘ ê°€ì§œ ì™€ì´íŒŒì´ ì˜ì‹¬',
                description: 'ê³µê²©ìê°€ ì§„ì§œ ì™€ì´íŒŒì´ì²˜ëŸ¼ ë³´ì´ê²Œ ë§Œë“  ê°€ì§œ ë„¤íŠ¸ì›Œí¬ì…ë‹ˆë‹¤.\n\nì—°ê²°í•˜ë©´ í†µì‹  ë‚´ìš©ì„ í›”ì¹˜ê±°ë‚˜ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ê°€ë¡œì±Œ ìˆ˜ ìˆì–´ìš”.',
                recommendations: [
                    'ğŸš« ì¦‰ì‹œ ì—°ê²°ì„ ëŠìœ¼ì„¸ìš”.',
                    'ğŸ” SSID(ì´ë¦„)ê°€ ë¹„ìŠ·í•˜ê±°ë‚˜ ë™ì¼í•´ë„ ì£¼ë³€ì— ìˆëŠ” ì›ë˜ ë„¤íŠ¸ì›Œí¬ì™€ MAC/ì œì¡°ì‚¬ ì •ë³´ê°€ ë‹¤ë¥´ë©´ ì˜ì‹¬í•˜ì„¸ìš”.',
                    'ğŸ” ì´ë¯¸ ì—°ê²°í–ˆë‹¤ë©´ ë¸Œë¼ìš°ì €ë‚˜ ì•±ì—ì„œ ë¡œê·¸ì¸, ê²°ì œ ê°™ì€ ë¯¼ê° ì‘ì—…ì„ í•˜ì§€ ë§ˆì„¸ìš”.',
                    'ğŸ” ê°€ëŠ¥í•˜ë©´ í•´ë‹¹ ë„¤íŠ¸ì›Œí¬ë¥¼ \'ìŠê¸°(Forget)\' ì²˜ë¦¬í•˜ì„¸ìš”.',
                    'ğŸ“¶ ê³µê³µ ì¥ì†Œì—ì„œëŠ” ê³µì‹ ì•ˆë‚´(ì¹´ìš´í„°/ì§ì›)ë¡œ ì •í™•í•œ SSID ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”.',
                    'ğŸ›¡ï¸ VPNì´ ìˆìœ¼ë©´ ì—°ê²°ì„ ëŠê³  VPNì„ ì¼œë‘ì„¸ìš”(ì—°ê²° ì „ì—).',
                    'ğŸš¨ ì˜ì‹¬ìŠ¤ëŸ¬ìš°ë©´ ì°¨ë‹¨/ì‹ ê³  ë²„íŠ¼ìœ¼ë¡œ ê´€ë¦¬ìë‚˜ ì•±ì— ì‹ ê³ í•˜ì„¸ìš”.'
                ],
                tips: []
            };
        }
        
        function getCommonTips() {
            return [
                'ğŸª ê³µê³µ ì™€ì´íŒŒì´ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ìˆì–´ë„ ì™„ì „íˆ ì•ˆì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
                'ğŸ” ê³µìœ ê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”.',
                'âš™ï¸ ê³µìœ ê¸° íŒì›¨ì–´ ì—…ë°ì´íŠ¸ë¥¼ ê¾¸ì¤€íˆ í•˜ë©´ í•´í‚¹ ìœ„í—˜ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.'
            ];
        }
        
        function formatGuidanceHTML(guidance, isRogue = false) {
            if (!guidance) return '';
            
            const descriptionHtml = guidance.description
                .split('\n')
                .map(line => escapeHtml(line))
                .join('<br>');
            
            const recommendationsHtml = guidance.recommendations && guidance.recommendations.length > 0
                ? `
                <div class="guidance-section">
                    <div class="guidance-section-title">ê¶Œì¥ ì‚¬í•­:</div>
                    <ul class="guidance-list">
                        ${guidance.recommendations.map(rec => `<li>${escapeHtml(rec)}</li>`).join('')}
                    </ul>
                </div>`
                : '';
            
            const tipsHtml = guidance.tips && guidance.tips.length > 0
                ? `
                <div class="guidance-section">
                    <div class="guidance-section-title">ì¶”ê°€ íŒ:</div>
                    <ul class="guidance-list">
                        ${guidance.tips.map(tip => `<li>${escapeHtml(tip)}</li>`).join('')}
                    </ul>
                </div>`
                : '';
            
            const className = isRogue ? 'popup-guidance popup-rogue-guidance' : 'popup-guidance';
            
            return `
                <div class="${className}">
                    <div class="guidance-box">
                        <div class="guidance-title">${escapeHtml(guidance.title)}</div>
                        <div class="guidance-description-box">
                            <div class="guidance-description">${descriptionHtml}</div>
                        </div>
                        ${recommendationsHtml}
                    </div>
                </div>
            `;
        }
        
        function showPopup(index) {
            if (!networksData || !networksData[index]) {
                return;
            }
            
            const network = networksData[index];
            const ssid = network.ssid || 'ì•Œ ìˆ˜ ì—†ìŒ';
            const protocol = network.protocol || 'N/A';
            const securityLevel = network.security_level || 'warning';
            const signal = network.signalStrength || 0;
            const bssid = network.bssid || 'N/A';
            const isRogue = !!network.isRogue;
            
            // ì‹ í˜¸ ê°•ë„ í‘œì‹œ
            let signalText = '';
            if (signal > -50) signalText = 'ê°•í•¨';
            else if (signal > -70) signalText = 'ë³´í†µ';
            else signalText = 'ì•½í•¨';
            
            // í”„ë¡œí† ì½œë³„ ì§€ì¹¨ ê°€ì ¸ì˜¤ê¸°
            const protocolGuidance = getProtocolGuidance(protocol);
            
            // Rogue AP ì§€ì¹¨ ê°€ì ¸ì˜¤ê¸°
            const rogueGuidance = isRogue ? getRogueAPGuidance() : null;
            
            // ê³µí†µ íŒ ê°€ì ¸ì˜¤ê¸°
            const commonTips = getCommonTips();
            
            // í”„ë¡œí† ì½œ ì§€ì¹¨ HTML ìƒì„±
            let guidanceHtml = '';
            if (rogueGuidance) {
                // Rogue APì¸ ê²½ìš° Rogue AP ì§€ì¹¨ì„ ë¨¼ì € í‘œì‹œ
                guidanceHtml += formatGuidanceHTML(rogueGuidance, true);
            }
            if (protocolGuidance) {
                // í”„ë¡œí† ì½œ ì§€ì¹¨ í‘œì‹œ
                guidanceHtml += formatGuidanceHTML(protocolGuidance);
            }
            
            // ê³µí†µ íŒ ì¶”ê°€
            if (commonTips && commonTips.length > 0) {
                guidanceHtml += `
                <div class="guidance-section guidance-tips">
                    <div class="guidance-section-title">ğŸ’¡ ì¶”ê°€ íŒ (ê³µí†µ)</div>
                    <ul class="guidance-list">
                        ${commonTips.map(tip => `<li>${escapeHtml(tip)}</li>`).join('')}
                    </ul>
                </div>`;
            }
            
            popupContent.innerHTML = `
                <div class="popup-title">${escapeHtml(ssid)}</div>
                
                <div class="popup-info-item">
                    <div class="popup-info-label">í”„ë¡œí† ì½œ</div>
                    <div class="popup-info-value">${escapeHtml(protocol)}</div>
                </div>
                
                <div class="popup-info-item">
                    <div class="popup-info-label">ì‹ í˜¸ ê°•ë„</div>
                    <div class="popup-info-value">${signalText} (${signal} dBm)</div>
                </div>
                
                <div class="popup-info-item">
                    <div class="popup-info-label">ìœ„í—˜ë„</div>
                    <div class="popup-info-value">
                        <span class="security-badge security-${securityLevel}">
                            ${getSecurityText(securityLevel)}
                        </span>
                    </div>
                </div>
                
                ${guidanceHtml}
            `;
            
            popupOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        function closePopup(event) {
            // ë°°ê²½ í´ë¦­ ì‹œì—ë§Œ ë‹«ê¸° (ì´ë²¤íŠ¸ê°€ ìˆê³  íƒ€ê²Ÿì´ ì˜¤ë²„ë ˆì´ì¸ ê²½ìš°)
            if (event && event.target !== popupOverlay) {
                return;
            }
            
            popupOverlay.classList.remove('show');
            document.body.style.overflow = '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì™€ì´íŒŒì´ ì •ë³´ í‘œì‹œ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(loadCurrentWifiInfo, 100);
            });
        } else {
            setTimeout(loadCurrentWifiInfo, 100);
        }
    </script>
</body>
</html>

